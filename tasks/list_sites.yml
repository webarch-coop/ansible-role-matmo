---
- name: Get all the sites in JSON format
  command: php console site:list --no-ansi -n --format=json
  args:
    chdir: "{{ matomo_html }}"
  check_mode: false
  become: true
  become_user: "{{ matomo_user }}"
  register: matomo_site_list_json
  tags:
    - matomo

- name: Create a sites dictionary
  set_fact:
    matomo_sites_dict: "{{ matomo_site_list_json.stdout | from_json }}"
  tags:
    - matomo

- name: Set matomo_sites_names to an empty array
  set_fact:
    matomo_site_names: []
  tags:
    - matomo

- name: Create a matomo_sites_names array
  set_fact:
    matomo_site_names: "{{ matomo_site_names }} + [ '{{ site.name }}' ]"
  loop: "{{ matomo_sites_dict | dict2items }}"
  loop_control:
    loop_var: site
    label: "{{ site.name }}"
  tags:
    - matomo
...
